<Window x:Class="OpenEasyN2N.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="OpenEasyN2N" Height="450" Width="550"
        WindowStartupLocation="CenterScreen" ResizeMode="NoResize"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent">

    <Window.Resources>
        <SolidColorBrush x:Key="AccentBrush" Color="#007ACC"/>
        <SolidColorBrush x:Key="MenuBackground" Color="#252526"/>

        <Style TargetType="TextBox">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style TargetType="Menu">
            <Setter Property="Background" Value="{StaticResource MenuBackground}"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
        </Style>

        <Style x:Key="{x:Static MenuItem.SubmenuHeaderTemplateKey}" TargetType="ContentControl">
            <Setter Property="Background" Value="#2D2D30"/>
        </Style>

        <Style TargetType="MenuItem">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid x:Name="RootGrid" SnapsToDevicePixels="True">
                            <Border x:Name="Bg" Background="Transparent" BorderThickness="0"/>

                            <ContentPresenter x:Name="HeaderHost"
                                              ContentSource="Header"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="Center"
                                              RecognizesAccessKey="True"/>

                            <Popup x:Name="PART_Popup"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                   PopupAnimation="Slide"
                                   Placement="Bottom"> <Border x:Name="SubMenuBorder"
                                        Background="#2D2D30"
                                        BorderBrush="#3F3F46"
                                        BorderThickness="1"
                                        Padding="2">
                                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter TargetName="PART_Popup" Property="Placement" Value="Right"/>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="#3E3E40"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Bg" Property="Background" Value="#007ACC"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="0,12,0,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ToolButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ToolBorder" Background="{TemplateBinding Background}" CornerRadius="8" Margin="2">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{TemplateBinding Tag}" FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,3"/>
                                <ContentPresenter HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ToolBorder" Property="Background" Value="#2D2D30"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.9" ScaleY="0.9"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MainActionButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="BtnBorder" Background="{TemplateBinding Background}" CornerRadius="17">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- <Trigger Property="IsMouseOver" Value="True"> -->
                            <!--     <Setter TargetName="BtnBorder" Property="Background" Value="#1C97EA"/> -->
                            <!-- </Trigger> -->
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border CornerRadius="12" Background="#1A1A1B" BorderBrush="#333333" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="28"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="75"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Background="#1A1A1B" CornerRadius="12,12,0,0" MouseLeftButtonDown="TitleBar_MouseDown">
                <Grid>
                    <TextBlock Text="OpenEasyN2N" Foreground="#666666" FontSize="10" Margin="15,0" VerticalAlignment="Center"/>
                    <Button Style="{StaticResource CloseButtonStyle}" Content="✕" HorizontalAlignment="Right" Width="45" Foreground="Gray" Click="BtnClose_Click"/>
                </Grid>
            </Border>

            <Menu Grid.Row="1" Background="#252526" BorderThickness="0,0,0,1" BorderBrush="#333333">
                <MenuItem Header="配置管理">
                    <MenuItem Header="导入配置">
                        <MenuItem Header="从文件导入" Click="ImportFromFile_Click"/>
                        <MenuItem Header="从剪贴板导入" Click="ImportFromClipboard_Click"/>
                    </MenuItem>
                    <MenuItem Header="导出配置">
                        <MenuItem Header="导出到文件" Click="ExportToFile_Click"/>
                        <MenuItem Header="导出到剪贴板" Click="ExportToClipboard_Click"/>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="驱动工具">
                    <MenuItem Header="安装虚拟网卡" Click="BtnInstall_Click"/>
                    <MenuItem Header="卸载虚拟网卡" Click="BtnUninstall_Click"/>
                </MenuItem>
                <MenuItem Header="帮助">
                    <MenuItem Header="关于软件">
                        <MenuItem Header="GitHub" Click="BtnToBaseURL_Click"/>
                        <MenuItem Header="Gitee" Click="BtnToBaseURL_Click"/>
                    </MenuItem>
                    <MenuItem Header="检查更新">
                        <MenuItem Header="GitHub" Click="BtnToUpdateURL_Click"/>
                        <MenuItem Header="Gitee" Click="BtnToUpdateURL_Click"/>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <Grid Grid.Row="2" Margin="30,15" VerticalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.1*"/>
                    <ColumnDefinition Width="0.9*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0">
                    <Grid Margin="5,0,0,8">
                        <TextBlock Text="连接配置" Foreground="{StaticResource AccentBrush}"
                                   FontSize="10" FontWeight="Bold" VerticalAlignment="Center"/>

                        <Button Content="额外参数"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Cursor="Hand"
                            Click="BtnExtraArgs_Click">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <StackPanel x:Name="container">
                                                <TextBlock Text="{TemplateBinding Content}"
                                                           x:Name="txt"
                                                           FontSize="11"
                                                           Foreground="#BBBBBB"
                                                           HorizontalAlignment="Center"/>
                                                <Rectangle x:Name="underline"
                                                           Height="0.8"
                                                           Fill="#BBBBBB"
                                                           Margin="0,1,0,0"
                                                           HorizontalAlignment="Stretch"/>
                                            </StackPanel>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                    </Grid>

                    <Border Background="#252526" CornerRadius="5" Padding="12,6" Margin="0,0,0,8" BorderBrush="#333333" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="服务器地址" FontSize="8" Foreground="#AAAAAA" Margin="0,0,0,2"/>
                            <TextBox x:Name="SuperNode" FontSize="13" Text="">
                                <TextBox.ToolTip>
                                    <ToolTip Content="服务器地址，如：n2n.test.com:1234"/>
                                </TextBox.ToolTip>
                            </TextBox>
                        </StackPanel>
                    </Border>

                    <Border Background="#252526" CornerRadius="5" Padding="12,6" Margin="0,0,0,8" BorderBrush="#333333" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="社区ID" FontSize="8" Foreground="#AAAAAA" Margin="0,0,0,2"/>
                            <TextBox x:Name="Community" FontSize="13" Text="">
                                <TextBox.ToolTip>
                                    <ToolTip Content="唯一社区ID，如：Hgasgiqjnnk"/>
                                </TextBox.ToolTip>
                            </TextBox>
                        </StackPanel>
                    </Border>

                    <Border Background="#252526" CornerRadius="5" Padding="12,6" Margin="0,0,0,8" BorderBrush="#333333" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="加密密钥" FontSize="8" Foreground="#AAAAAA" Margin="0,0,0,2"/>
                            <TextBox x:Name="Password" FontSize="13" Text="">
                                <TextBox.ToolTip>
                                    <ToolTip Content="加密密钥，可不填写"/>
                                </TextBox.ToolTip>
                            </TextBox>
                        </StackPanel>
                    </Border>

                    <Border Background="#252526" CornerRadius="5" Padding="12,6" Margin="0,0,0,12" BorderBrush="#333333" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="虚拟IP地址" FontSize="8" Foreground="#AAAAAA" Margin="0,0,0,2"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" x:Name="VirtualIp" FontSize="13" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" x:Name="AutoIp" Content="自动获取" IsChecked="False"  Checked="AutoIp_Checked" Unchecked="AutoIp_Unchecked" Foreground="#888888" FontSize="11" VerticalAlignment="Center" Margin="5,0,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <Button Style="{StaticResource MainActionButtonStyle}"
                            x:Name="StartButton"
                            Content="启动连接"
                            Background="{StaticResource AccentBrush}"
                            Height="38"
                            Click="BtnLink_Click"
                            FontSize="14" FontWeight="SemiBold"/>
                </StackPanel>

                <Border Grid.Column="1" Background="#121212" CornerRadius="12" BorderBrush="#2D2D30" BorderThickness="1" Margin="10,8,0,8">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                            <Ellipse x:Name="StatusDot" Width="8" Height="8" Fill="#444444" Margin="0,0,8,0"/>
                            <TextBlock x:Name="StatusText" Text="未连接" Foreground="#888888" FontSize="12"/>
                        </StackPanel>

                        <TextBlock Text="实时速率" FontSize="10" Foreground="#555555" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,15">
                            <TextBlock Text="↑" Foreground="#E81123" FontWeight="Bold" Margin="5,0,2,0"/>
                            <TextBlock x:Name="UploadSpeed" Text="0 B/s" Foreground="White" FontSize="14" FontFamily="Consolas"/>
                            <TextBlock Text="↓" Foreground="#00FF00" FontWeight="Bold" Margin="15,0,2,0"/>
                            <TextBlock x:Name="DownloadSpeed" Text="0 B/s" Foreground="White" FontSize="14" FontFamily="Consolas"/>
                        </StackPanel>

                        <Rectangle Height="1" Fill="#252526" Width="100" Margin="0,5"/>

                        <TextBlock Text="本次总流量" FontSize="10" Foreground="#555555" HorizontalAlignment="Center" Margin="0,10,0,5"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="↑" Foreground="#E81123" Opacity="0.6" Margin="5,0,2,0"/>
                            <TextBlock x:Name="TotalUpload" Text="0.00 MB" Foreground="#AAAAAA" FontSize="12" FontFamily="Consolas"/>
                            <TextBlock Text="↓" Foreground="#00FF00" Opacity="0.6" Margin="15,0,2,0"/>
                            <TextBlock x:Name="TotalDownload" Text="0.00 MB" Foreground="#AAAAAA" FontSize="12" FontFamily="Consolas"/>
                        </StackPanel>

                        <Rectangle Height="1" Fill="#252526" Width="100" Margin="0,12,0,8"/> <TextBlock Text="当前分配 IP" FontSize="10" Foreground="#555555" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                        <Border Background="#1A1A1B" CornerRadius="4" Padding="8,3" BorderBrush="#2D2D30" BorderThickness="1" HorizontalAlignment="Center">
                            <TextBox x:Name="CurrentIpText"
         Text="0.0.0.0"
         Foreground="{StaticResource AccentBrush}"
         FontSize="13"
         FontWeight="Bold"
         FontFamily="Consolas"
         HorizontalAlignment="Center"
         IsReadOnly="True"
         BorderThickness="0"
         Background="Transparent"
         Focusable="True"
         IsHitTestVisible="True"

         SelectionBrush="#33007ACC" SelectionOpacity="0.3"    FocusVisualStyle="{x:Null}" />

                        </Border>
                    </StackPanel>
                </Border>
            </Grid>

            <Border Grid.Row="3" Background="#0F0F0F" CornerRadius="0,0,12,12" Padding="8">
                <UniformGrid Columns="4">
                    <Button Style="{StaticResource ToolButtonStyle}" Tag="🌐" Content="在线成员" Click="BtnShowPeers_Click"/>
                    <Button Style="{StaticResource ToolButtonStyle}" Tag="📜" Content="运行日志" Click="BtnLog_Click"/>
                    <Button Style="{StaticResource ToolButtonStyle}" Tag="⚡" Content="Ping工具" Click="BtnShowPing_Click"/>
                    <Button Style="{StaticResource ToolButtonStyle}" Tag="⚙" Content="更多工具"/>
                </UniformGrid>
            </Border>

            <Popup x:Name="ExtraArgsPopup" Placement="Center" AllowsTransparency="True" StaysOpen="False" PopupAnimation="Fade">
                <Border Background="#2D2D30" BorderBrush="#333333" BorderThickness="1" CornerRadius="8" Width="300" Padding="15">
                    <StackPanel>
                        <TextBlock Text="额外启动参数" Foreground="{StaticResource AccentBrush}" FontSize="11" FontWeight="Bold" Margin="0,0,0,10"/>
                        <TextBlock Text="输入 n2n 命令行参数 (如: -v -r -E)" Foreground="#888888" FontSize="10" Margin="0,0,0,5"/>
                        <Border Background="#1A1A1B" CornerRadius="4" Padding="5" BorderBrush="#333333" BorderThickness="1">
                            <TextBox x:Name="ExtraArgsTextBox"
                                     FontSize="12"
                                     Height="60"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     VerticalContentAlignment="Top"/>
                        </Border>
                    </StackPanel>
                </Border>
            </Popup>

        </Grid>
    </Border>
</Window>